<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SnapShot Result</title>
    <link rel="stylesheet" href="result.css">

    <script type="module">
        // Firebase SDK 가져오기
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js";
        import { getFirestore, collection, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore.js";
        
        // Firebase 설정
        const firebaseConfig = {
          apiKey: "AIzaSyAZX7_fPX0B_-EA-OGvW6KmalFOGsQ3ZQU",
          authDomain: "snapshot-4ad8f.firebaseapp.com",
          projectId: "snapshot-4ad8f",
          storageBucket: "snapshot-4ad8f.appspot.com",
          messagingSenderId: "1004891389072",
          appId: "1:1004891389072:web:35514d2ddafce071a42c15",
          measurementId: "G-1CZJZJRGG3"
        };
      
        // Firebase 초기화
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // 점수 불러오기 및 표시 함수
        async function loadRanking() {
            const scoresRef = collection(db, "users"); // users 컬렉션에서 점수 불러옴
            const q = query(scoresRef, orderBy("highestScore", "asc"));  // 최고 기록 기준으로 내림차순 정렬
            const querySnapshot = await getDocs(q);

            let rankingList = '';
            querySnapshot.forEach((doc, index) => {
                const { name, highestScore } = doc.data();
                rankingList += `<tr>
                                  <td>${index + 1}</td>
                                  <td>${name}</td>
                                  <td>${highestScore.toFixed(3)} cm</td>
                                </tr>`;
            });

            document.getElementById('ranking-list').innerHTML = rankingList;
        }

        window.onload = loadRanking;  // 페이지 로드 시 랭킹 로드
    </script>
</head>
<body>
    <div class="container">
        <h1>게임 랭킹</h1>

        <!-- 순위와 기록을 표시하는 테이블 -->
        <table id="ranking-table" border="1" cellspacing="0" cellpadding="5">
            <thead>
                <tr>
                    <th>순위</th>
                    <th>이름</th>
                    <th>기록</th>
                </tr>
            </thead>
            <tbody id="ranking-list">
                <!-- Firebase에서 데이터를 불러와 여기에 표시 -->
            </tbody>
        </table>

        <!-- 다시하기 버튼 -->
        <button onclick="window.location.href='index.html'">다시 하기</button>
    </div>
</body>
</html>
